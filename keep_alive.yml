name: ğŸ”„ Keep Render Backend Alive (NutriLens)

on:
  schedule:
    - cron: "*/15 * * * *"  # every 15 minutes
  workflow_dispatch:        # allows manual trigger

jobs:
  ping-render:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸŒ Send keep-alive request
        run: |
          echo "Pinging Render backend to prevent sleep..."
          python - <<'EOF'
import requests, sys, datetime

url = "https://nutrilens-model.onrender.com/health"
timestamp = datetime.datetime.utcnow().strftime("%Y-%m-%d %H:%M:%S UTC")

try:
    r = requests.get(url, timeout=10)
    print(f"ğŸ•’ [{timestamp}] Pinged {url}")
    print("Status:", r.status_code)
    print("Response:", r.text)
    if r.status_code == 200:
        print("âœ… Backend is awake and responding.")
    else:
        print("âš ï¸ Unexpected status code:", r.status_code)
except Exception as e:
    print(f"âŒ Failed to reach backend at {timestamp}: {e}")
    sys.exit(1)
EOF
